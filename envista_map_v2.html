<!DOCTYPE html>
<html>
<head>
	<title>Envista Test Map</title>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

   <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" /> -->
     <link rel="stylesheet" href="https://npmcdn.com/leaflet@1.0.0-rc.2/dist/leaflet.css" />
	<!--[if lte IE 8]><link rel="stylesheet" href="../dist/leaflet.ie.css" /><![endif]-->
    <link rel="stylesheet" href="leaflet_plugins/MarkerCluster.css"/>
    
    <style type="text/css">
    html, body, #map{
     height: 100%;
     width: 100%;
     margin: 0;
     padding: 0;
    }
    </style>
</head>
<body>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script> -->
    <script src="https://npmcdn.com/leaflet@1.0.0-rc.2/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="leaflet_plugins/Leaflet.MarkerCluster.js"></script>
    <div id="map"></div>

    <script>
        var map = L.map('map');
        var zoommax = 18;

        // BASEMAPS
        // Additional basemaps @ https://leaflet-extras.github.io/leaflet-providers/preview/
        
        // OpenStreetMap Black and White basemap
        var OpenStreetMap_BlackAndWhite = L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        });
        //map.addLayer(OpenStreetMap_BlackAndWhite);

        
        // Open Map Surfer Roads Basemap
        var OpenMapSurfer_Roads = L.tileLayer('http://korona.geog.uni-heidelberg.de/tiles/roads/x={x}&y={y}&z={z}', {
        maxZoom: 20,
        attribution: 'Imagery from <a href="http://giscience.uni-hd.de/">GIScience Research Group @ University of Heidelberg</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        });
        map.addLayer(OpenMapSurfer_Roads);
        
        
        // OVERLAYS
 
        // Add maximum temperature data
//        var envista_proj = new L.geoJson();
//        envista_proj.addTo(map);
//
//        $.ajax({
//        dataType: "json",
//        url: "https://data.sfgov.org/resource/dsie-4zfb.geojson",
//        success: function(data) {
//            $(data.features).each(function(key, data) {
//            envista_proj.addData(data);
//            });
//        }
//        }).error(function() {});

        ///===========
        var smallIcon = new L.Icon({
    iconUrl: 'icons/placeholder-29.svg',
    iconRetinaUrl: 'icons/placeholder-29.svg',
    iconSize:    [34, 34], // size of the icon
    iconAnchor:  [12, 30], // point of the icon which will correspond to marker's location
    popupAnchor: [4, -30], // point from which the popup should open relative to the iconAnchor
    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
    shadowSize:  [41, 41], // size of the shadow
    shadowAnchor: [7, 37],  // point of the shadow which will correspond to shadow's location
});

function onEachFeature(feature, layer) {
    console.log(feature);
    var popupText = "<strong>Summary statistics for the daily high"
                + "<br>temperatures (&deg;F) during the 30 days"
                + "<br>between 6/7/16 and 7/6/16 inclusive</strong>"
                + "<br>City: " + feature.properties.city
                + "<br>Range of Daily Highs: " + feature.properties.range_tmax.toFixed(1)
                + "<br>Highest Daily High: " + feature.properties.max_tmax.toFixed(1)
                + "<br>Lowest Daily High: " + feature.properties.min_tmax.toFixed(1)
                + "<br>Average Daily High: " + feature.properties.mean_tmax.toFixed(1)
                + "<br>Standard Deviation of Daily Highs: "
                + feature.properties.sd_tmax.toFixed(2);
    layer.bindPopup(popupText);
}

var max_temps = new L.geoJson(null, {
    pointToLayer: function(feature, latlng) {
        console.log(latlng, feature);
        return L.marker(latlng, {
          icon: smallIcon
        });
      },
      onEachFeature: onEachFeature
});
max_temps.addTo(map);

$.ajax({
    dataType: "json",
    url: "https://data.sfgov.org/resource/dsie-4zfb.geojson",
    success: function(data) {
        $(data.features).each(function(key, data) { 
            max_temps.addData(data);
        });
        
    }
}).error(function() {});
        
        
        ////////-------------

        // Define and display the control for Basemaps and Overlays
        var baseLayers = {
            "Open Street Map - B&W": OpenStreetMap_BlackAndWhite,
            "Open Map Surfer Roads": OpenMapSurfer_Roads
        };
        var overlays = {
            "Construction Projects": envista_proj,
        };
        L.control.layers(baseLayers, overlays).addTo(map);

        map.setView([37.759313, -122.441815], 13);
    </script>
</body>
</html>